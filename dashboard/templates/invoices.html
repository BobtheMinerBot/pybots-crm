{% extends "base.html" %}

{% block title %}Invoices â€” ISLA Builders{% endblock %}

{% block content %}
<header class="main-header">
  <h2>Invoices</h2>
  <div class="header-meta">
    <a href="https://app.jobtread.com" target="_blank" class="btn btn-primary">
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
      </svg>
      Create Invoice in JobTread
    </a>
  </div>
</header>

<!-- AR Summary -->
<div class="metrics-grid" style="grid-template-columns: repeat(4, 1fr); margin-bottom: var(--space-6);">
  <div class="metric-card">
    <div class="metric-label">Total Outstanding</div>
    <div class="metric-value currency" id="metric-outstanding">-</div>
    <div class="metric-trend">All unpaid invoices</div>
  </div>
  <div class="metric-card">
    <div class="metric-label">Current (0-30)</div>
    <div class="metric-value currency" id="metric-current">-</div>
    <div class="metric-trend up">On time</div>
  </div>
  <div class="metric-card">
    <div class="metric-label">Past Due (31-60)</div>
    <div class="metric-value currency" id="metric-pastdue">-</div>
    <div class="metric-trend" style="background: var(--warning-soft); color: var(--warning);">Needs attention</div>
  </div>
  <div class="metric-card">
    <div class="metric-label">Overdue (60+)</div>
    <div class="metric-value currency" id="metric-overdue">-</div>
    <div class="metric-trend" style="background: var(--destructive-soft); color: var(--destructive);">Action required</div>
  </div>
</div>

<!-- Aging Visualization -->
<div class="card" style="margin-bottom: var(--space-6);">
  <div class="card-header">
    <span class="card-title">Accounts Receivable Aging</span>
  </div>
  <div class="aging-bar">
    <div class="aging-segment current" style="width: 60%;" title="Current: $0">
      <span>Current</span>
    </div>
    <div class="aging-segment warning" style="width: 25%;" title="31-60 Days: $0">
      <span>31-60</span>
    </div>
    <div class="aging-segment danger" style="width: 15%;" title="60+ Days: $0">
      <span>60+</span>
    </div>
  </div>
</div>

<!-- Invoice List -->
<div class="card">
  <div class="card-header">
    <span class="card-title">Recent Invoices</span>
    <div style="display: flex; gap: var(--space-3); align-items: center;">
      <select id="filterStatus" class="select-control" onchange="filterInvoices()">
        <option value="all">All</option>
        <option value="unpaid">Unpaid</option>
        <option value="paid">Paid</option>
        <option value="overdue">Overdue</option>
      </select>
    </div>
  </div>
  
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Invoice #</th>
          <th>Client</th>
          <th>Job</th>
          <th>Amount</th>
          <th>Due Date</th>
          <th>Status</th>
          <th>Age</th>
        </tr>
      </thead>
      <tbody id="invoicesTable">
        <tr>
          <td colspan="7" class="empty-state">
            <div class="empty-state-icon">ðŸ’°</div>
            <div class="empty-state-text">Invoice tracking coming soon</div>
            <p style="font-size: 12px; color: var(--text-muted); margin-top: var(--space-2);">
              Luna will pull invoice data from JobTread
            </p>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<style>
.select-control {
  padding: 6px 10px;
  border: 1px solid var(--border-default);
  border-radius: var(--radius-sm);
  font-size: 13px;
  background: var(--bg-surface);
  color: var(--text-primary);
}

.aging-bar {
  display: flex;
  height: 40px;
  border-radius: var(--radius-sm);
  overflow: hidden;
  margin-top: var(--space-4);
}

.aging-segment {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: 500;
  color: white;
  transition: width 0.3s ease;
}

.aging-segment.current {
  background: var(--success);
}

.aging-segment.warning {
  background: var(--warning);
}

.aging-segment.danger {
  background: var(--destructive);
}

.aging-segment span {
  text-shadow: 0 1px 2px rgba(0,0,0,0.2);
}
</style>
{% endblock %}

{% block scripts %}
<script>
// Placeholder - will connect to JobTread invoice API
function filterInvoices() {
  console.log('Filter invoices:', document.getElementById('filterStatus').value);
}

document.addEventListener('DOMContentLoaded', () => {
  // Will load invoice data from JobTread
});
</script>
{% endblock %}
