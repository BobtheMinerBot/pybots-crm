{% extends "base.html" %}

{% block title %}Schedule ‚Äî ISLA Builders{% endblock %}

{% block content %}
<header class="main-header">
  <h2>Schedule</h2>
  <div class="header-meta">
    <a href="https://calendar.google.com" target="_blank" class="btn btn-secondary">
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
      </svg>
      Open Google Calendar
    </a>
  </div>
</header>

<!-- Today's Overview -->
<div class="content-grid" style="margin-bottom: var(--space-6);">
  <div class="card">
    <div class="card-header">
      <span class="card-title">Today ‚Äî <span id="todayDate"></span></span>
    </div>
    <div id="todayEvents">
      <div class="empty-state">
        <div class="empty-state-icon">üìÖ</div>
        <div class="empty-state-text">Calendar integration coming soon</div>
        <p style="font-size: 12px; color: var(--text-muted); margin-top: var(--space-2);">
          Luna will sync your Google Calendar events here
        </p>
      </div>
    </div>
  </div>
  
  <div class="card">
    <div class="card-header">
      <span class="card-title">Follow-ups Due</span>
    </div>
    <div id="followupsList">
      <div class="list-item">
        <div class="list-item-main">
          <div class="list-item-title">Kent Lee</div>
          <div class="list-item-sub">Spalling repair follow-up</div>
        </div>
        <span class="badge warning">Due today</span>
      </div>
      <div class="list-item">
        <div class="list-item-main">
          <div class="list-item-title">chefcelena1</div>
          <div class="list-item-sub">New construction qualification call</div>
        </div>
        <span class="badge new">New lead</span>
      </div>
    </div>
  </div>
</div>

<!-- Week View -->
<div class="card">
  <div class="card-header">
    <span class="card-title">This Week</span>
    <div style="display: flex; gap: var(--space-2);">
      <button class="btn btn-secondary" style="padding: 4px 8px;" onclick="prevWeek()">‚Üê</button>
      <button class="btn btn-secondary" style="padding: 4px 8px;" onclick="nextWeek()">‚Üí</button>
    </div>
  </div>
  
  <div class="week-grid" id="weekGrid">
    <!-- Generated by JS -->
  </div>
</div>

<!-- Site Visits Section -->
<div class="card" style="margin-top: var(--space-6);">
  <div class="card-header">
    <span class="card-title">Upcoming Site Visits</span>
    <a href="/leads" class="card-action">Schedule new ‚Üí</a>
  </div>
  <div id="siteVisitsList">
    <div class="empty-state">
      <div class="empty-state-icon">üè†</div>
      <div class="empty-state-text">No site visits scheduled</div>
      <p style="font-size: 12px; color: var(--text-muted); margin-top: var(--space-2);">
        Site visits will appear here when scheduled from leads
      </p>
    </div>
  </div>
</div>

<style>
.week-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 1px;
  background: var(--border-subtle);
  border-radius: var(--radius-sm);
  overflow: hidden;
  margin-top: var(--space-4);
}

.week-day {
  background: var(--bg-surface);
  min-height: 120px;
  padding: var(--space-3);
}

.week-day.today {
  background: var(--accent-ocean-soft);
}

.week-day-header {
  font-size: 11px;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  margin-bottom: var(--space-1);
}

.week-day-date {
  font-size: 18px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: var(--space-3);
}

.week-day.today .week-day-date {
  color: var(--accent-ocean);
}

.week-event {
  font-size: 11px;
  padding: 4px 6px;
  background: var(--bg-inset);
  border-radius: 4px;
  margin-bottom: 4px;
  border-left: 2px solid var(--accent-ocean);
}

.week-event.site-visit {
  border-left-color: var(--accent-lime);
  background: var(--accent-lime-soft);
}

.week-event.follow-up {
  border-left-color: var(--accent-coral);
  background: var(--accent-coral-soft);
}
</style>
{% endblock %}

{% block scripts %}
<script>
let currentWeekStart = getWeekStart(new Date());

function getWeekStart(date) {
  const d = new Date(date);
  const day = d.getDay();
  const diff = d.getDate() - day;
  return new Date(d.setDate(diff));
}

function renderWeek() {
  const grid = document.getElementById('weekGrid');
  const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  
  let html = '';
  
  for (let i = 0; i < 7; i++) {
    const date = new Date(currentWeekStart);
    date.setDate(date.getDate() + i);
    
    const isToday = date.getTime() === today.getTime();
    
    html += `
      <div class="week-day ${isToday ? 'today' : ''}">
        <div class="week-day-header">${days[i]}</div>
        <div class="week-day-date">${date.getDate()}</div>
        <div class="week-day-events">
          ${isToday ? '<div class="week-event follow-up">Follow-up: Kent Lee</div>' : ''}
        </div>
      </div>
    `;
  }
  
  grid.innerHTML = html;
}

function prevWeek() {
  currentWeekStart.setDate(currentWeekStart.getDate() - 7);
  renderWeek();
}

function nextWeek() {
  currentWeekStart.setDate(currentWeekStart.getDate() + 7);
  renderWeek();
}

function updateTodayDate() {
  const today = new Date();
  document.getElementById('todayDate').textContent = today.toLocaleDateString('en-US', {
    weekday: 'long',
    month: 'long',
    day: 'numeric'
  });
}

document.addEventListener('DOMContentLoaded', () => {
  updateTodayDate();
  renderWeek();
});
</script>
{% endblock %}
